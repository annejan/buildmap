Buildmap
========

A GIS workflow pipeline for designing festivals. Buildmap takes a CAD
site plan in DXF format and produces a slippy map for viewing on the
web. It supports generating both raster layers (rendered with Mapnik),
and untiled GeoJSON vector layers, which can be rendered by the map
viewer.

![Map of EMF 2016](/docs/emf2016.png?raw=true)

A Diagram
=========

![buildmap diagram](/docs/diagram.png?raw=true)

Requirements
============

    apt-get install postgresql-9.4 postgresql-9.4-postgis-2.1 gdal-bin tilecache ttf-mscorefonts-installer
    apt-get install python-jinja2 python-mapnik python-psycopg2 python-gdal


You'll also need to install
[Magnacarto](https://github.com/omniscale/magnacarto) into your `$PATH`
(you only need the `magnacarto` binary and not the webapp).

Source Files
============

You will need at least one `.dxf` file to use as a source, and at least
one `.mss` (CartoCSS) file to control formatting. Each .mss file will
produce one output layer (which can be controlled on the OpenLayers
map).

Web Viewer
==========

You will need a website with a javascript map viewer to view the
generated tiles. Both OpenLayers 3 and Leaflet work for this, however
OpenLayers seems to have better performance for vector layers.

The most up-to-date web interface currently is the [SHA2017 maps
site](https://github.com/sha2017/maps-web).

Setup
=====

As the Postgres user:

    createuser buildmap
    createdb -O buildmap -EUNICODE [databasename]
    psql -d [databasename] -c "CREATE EXTENSION postgis;"

Allow your user to access the GIS database. The easiest (although not
necessarily most secure) way of doing this is to add the following line
to `pg_hba.conf`

    local   [databasename]         buildmap                   trust

Then test this with:

    psql -U buildmap [database name]


Configuration
=============

You need to create two configuration files - one (local.conf) will contain
the host-specific configuration (paths and database details), the other
(map.conf) will contain the rendering configuration for your map.

Example config files can be found in the [config directory](/config).

Running Buildmap
================

`python ./buildmap.py /path/to/map.conf /path/to/local.conf`

You can optionally pass the `--preseed` command line option, which will cause
buildmap to generate all the tiles when it runs.

Alternatively you can use Tilestache to serve the map tiles dynamically,
using the `tilestache.json` file generated by buildmap.

Credits
=======

[Russ Garrett](https://github.com/russss)

This is based on [Redlizard's](https://github.com/redlizard) work for OHM2013.
